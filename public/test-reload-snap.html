<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Snap After Reload</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { background-color: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background-color: #0056b3; }
        .log { background-color: #f8f9fa; border: 1px solid #dee2e6; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üß™ Test Snap.js After Reload</h1>
    
    <div class="test-section info">
        <h3>üìã Test Information</h3>
        <p>Halaman ini untuk menguji apakah Midtrans Snap.js berfungsi setelah reload halaman.</p>
        <p><strong>Waktu reload terakhir:</strong> <span id="reload-time"></span></p>
    </div>

    <div class="test-section">
        <h3>üîß Snap.js Status</h3>
        <div id="snap-status">Checking...</div>
        <button onclick="checkSnapStatus()">Check Snap Status</button>
        <button onclick="testSnapPopup()">Test Snap Popup</button>
        <button onclick="location.reload()">Reload Page</button>
    </div>

    <div class="test-section">
        <h3>üìù Console Log</h3>
        <div id="console-log" class="log"></div>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <!-- Midtrans Snap.js -->
    <script src="https://app.sandbox.midtrans.com/snap/snap.js" data-client-key="SB-Mid-client-yXcEzjhVAqWaf3qm"></script>
    
    <script>
        // Log function
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('console-log');
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #666;">[${timestamp}]</span> ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        // Clear log
        function clearLog() {
            document.getElementById('console-log').innerHTML = '';
        }

        // Check Snap status
        function checkSnapStatus() {
            log('=== Checking Snap Status ===');
            
            const statusDiv = document.getElementById('snap-status');
            
            // Check if snap is loaded
            if (typeof snap !== 'undefined') {
                log('‚úÖ Snap.js loaded successfully');
                statusDiv.innerHTML = '<div class="success">‚úÖ Snap.js loaded successfully</div>';
                
                // Check snap object
                log('Snap object:', snap);
                log('Snap.pay function available:', typeof snap.pay === 'function');
                
                if (typeof snap.pay === 'function') {
                    log('‚úÖ snap.pay function is available');
                } else {
                    log('‚ùå snap.pay function is NOT available');
                    statusDiv.innerHTML = '<div class="error">‚ùå snap.pay function is NOT available</div>';
                }
            } else {
                log('‚ùå Snap.js is NOT loaded');
                statusDiv.innerHTML = '<div class="error">‚ùå Snap.js is NOT loaded</div>';
            }
            
            // Check window.snap
            log('Window.snap available:', typeof window.snap !== 'undefined');
            
            // Check global variables
            log('Global snap variable:', typeof snap !== 'undefined' ? 'Available' : 'Not available');
        }

        // Test Snap popup
        function testSnapPopup() {
            log('=== Testing Snap Popup ===');
            
            if (typeof snap !== 'undefined' && snap.pay) {
                log('‚úÖ Snap is available, testing popup...');
                
                try {
                    // Test with a dummy token (this will show error but popup should appear)
                    snap.pay('test-token-123', {
                        onSuccess: function(result) {
                            log('‚úÖ Payment Success:', result);
                            alert('Payment Success! (This is expected with dummy token)');
                        },
                        onPending: function(result) {
                            log('‚è≥ Payment Pending:', result);
                            alert('Payment Pending!');
                        },
                        onError: function(result) {
                            log('‚ùå Payment Error:', result);
                            alert('Payment Error (expected with dummy token)!');
                        },
                        onClose: function() {
                            log('üö™ Payment Popup Closed');
                            alert('Payment Popup Closed!');
                        }
                    });
                    
                    log('‚úÖ snap.pay called successfully');
                } catch (error) {
                    log('‚ùå Error calling snap.pay:', error.message);
                    alert('Error calling snap.pay: ' + error.message);
                }
            } else {
                log('‚ùå Snap is not available');
                alert('Snap is not available! Check console for details.');
            }
        }

        // Auto-check on page load
        window.onload = function() {
            log('=== Page Loaded ===');
            log('Checking Snap availability on page load...');
            
            // Set reload time
            document.getElementById('reload-time').textContent = new Date().toLocaleString();
            
            // Wait a bit for scripts to load
            setTimeout(function() {
                checkSnapStatus();
            }, 1000);
        };

        // Log script loading
        log('Script loaded, waiting for Snap.js...');
    </script>
</body>
</html> 