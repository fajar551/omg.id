<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Product Payment Snap</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h4>Test Product Payment Snap</h4>
                    </div>
                    <div class="card-body">
                        <div id="debug-info" class="alert alert-info">
                            <strong>Debug Info:</strong>
                            <div id="snap-status">Checking Snap availability...</div>
                        </div>
                        
                        <button id="test-snap" class="btn btn-primary">Test Snap Payment</button>
                        <button id="test-ajax" class="btn btn-success ms-2">Test AJAX Request</button>
                        
                        <div id="result" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Midtrans Snap.js Script -->
    <script type="text/javascript" src="https://app.sandbox.midtrans.com/snap/snap.js" data-client-key="SB-Mid-client-yXcEzjhVAqWaf3qm"></script>
    
    <script>
        $(document).ready(function() {
            console.log('Page loaded, checking Snap availability...');
            
            // Check Snap availability
            function checkSnapAvailability() {
                if (typeof snap !== 'undefined' && snap.pay) {
                    $('#snap-status').html('<span class="text-success">‚úÖ Snap is available</span>');
                    console.log('‚úÖ Snap is available');
                    return true;
                } else {
                    $('#snap-status').html('<span class="text-danger">‚ùå Snap is not available</span>');
                    console.log('‚ùå Snap is not available');
                    return false;
                }
            }
            
            // Initial check
            setTimeout(checkSnapAvailability, 1000);
            
            // Test Snap Payment
            $('#test-snap').click(function() {
                if (!checkSnapAvailability()) {
                    alert('Snap is not available. Please check the console for errors.');
                    return;
                }
                
                console.log('Testing Snap payment...');
                
                // Test token (this is just for testing)
                const testToken = 'test-token-123';
                
                snap.pay(testToken, {
                    onSuccess: function(result) {
                        console.log('‚úÖ Payment success:', result);
                        $('#result').html('<div class="alert alert-success">Payment Success!</div>');
                    },
                    onPending: function(result) {
                        console.log('‚è≥ Payment pending:', result);
                        $('#result').html('<div class="alert alert-warning">Payment Pending</div>');
                    },
                    onError: function(result) {
                        console.log('‚ùå Payment error:', result);
                        $('#result').html('<div class="alert alert-danger">Payment Error</div>');
                    },
                    onClose: function() {
                        console.log('üö™ Payment popup closed');
                        $('#result').html('<div class="alert alert-info">Payment Popup Closed</div>');
                    }
                });
            });
            
            // Test AJAX Request
            $('#test-ajax').click(function() {
                console.log('Testing AJAX request...');
                
                $.ajax({
                    url: '/api/product/payment/token',
                    method: 'POST',
                    data: {
                        product_id: 1,
                        buyer_name: 'Test User',
                        buyer_email: 'test@example.com',
                        quantity: 1,
                        page_name: 'test-page',
                        payment_method_id: 1,
                        _token: 'test-token'
                    },
                    success: function(response) {
                        console.log('‚úÖ AJAX Success:', response);
                        $('#result').html('<div class="alert alert-success">AJAX Success: ' + JSON.stringify(response) + '</div>');
                    },
                    error: function(xhr, status, error) {
                        console.log('‚ùå AJAX Error:', {xhr: xhr, status: status, error: error});
                        $('#result').html('<div class="alert alert-danger">AJAX Error: ' + error + '</div>');
                    }
                });
            });
        });
    </script>
</body>
</html> 